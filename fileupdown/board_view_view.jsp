<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="java.io.PrintWriter" %>
<%@ page import="board.Board" %>
<%@ page import="board.BoardDAO" %>
<%@include file = "/assets/header.jsp"%>
<%@ page import = "java.net.URLEncoder"%>
	<%
	int bbsID = 0;
		if (request.getParameter("bbsID") != null) {
			bbsID = Integer.parseInt(request.getParameter("bbsID"));
		}
		if(bbsID == 0) {
			PrintWriter script = response.getWriter();
			script.println("<script>");
			script.println("alert('유효하지 않은 글입니다.')");
			script.println("location.href = '/fileupdown/board.jsp'");
			script.println("</script>");
		}
		Board board = new BoardDAO().getboard(bbsID);
		String savePath = board.getfilepath();
		if (savePath != null){
		savePath = savePath.replace(request.getRealPath("/"), "");
		}
	%>
<main>

  <div class="page-hero-section bg-image hero-mini" style="background-image: url(/bank/assets/img/hero_mini.svg);">
    <div class="hero-caption">
      <div class="container fg-white h-100">
        <div class="row justify-content-center align-items-center text-center h-100">
          <div class="col-lg-6">
            <h2 class="mb-4 fw-medium">File Up&Download Board</h2>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-dark justify-content-center bg-transparent">
                <li class="breadcrumb-item"><a href="/bank/main.jsp">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">File Up&Download Board</li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="page-section">
    <div class="container">
        <div>
          <article class="blog-single-entry">
            <div>
			 <% if (savePath != null) { %>
              <img src="/bank/<%=savePath%>"  class="rounded mx-auto d-block">
			 <% } else { %>
			  <img src="/bank/assets/img/blogs/noimage.jpg" class="rounded mx-auto d-block">
			  <% } %>
            </div>
			</br></br>
            <div class="post-date">
              Posted on <p><%= board.getb_date().substring(0, 11) + board.getb_date().substring(11, 13) + "시 " + board.getb_date().substring(14, 16) + "분" %></p>
            </div>
			</br>
            <h1 class="post-title"><%= board.gettitle().replaceAll(" ", "&nbsp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll("\n", "<br>") %></h1>
			
            <div class="entry-meta mb-4">
              <div class="meta-item entry-author">
                <div class="icon">
                  <span class="mai-person"></span>  
                </div>
                by <%= board.getu_id() %>
              </div>
			  
			  <% if (savePath != null) { %>
              <div class="meta-item">
                <div class="icon">
                  <span class="mai-pricetags"></span>
                </div>
                File download available 
              </div>
			  <% } %>
			  </br></br>
            </div>
			<div class="card">
            <div class="entry-content">
              <p><%= board.getcontent() %></p>
            </div>
			</div>
			</br></br>
          </article>
		  
<%
				if(userID != null && userID.equals(board.getu_id())) {
			%>
				<a href="/bank/fileupdown/board_update_view.jsp?bbsID=<%= bbsID %>" class="btn btn-primary">수정</a>
				<a onclick="return confirm('정말로 삭제하시겠습니까?')" href="/bank/fileupdown/board_delete_controller.jsp?bbsID=<%= bbsID %>" class="btn btn-primary">삭제</a>
			<%
				}
			%>
			
			 <% if (savePath != null) {
        savePath = URLEncoder.encode(savePath, "UTF-8"); %>
			 <a href="/bank/fileupdown/board_download_controller.jsp?bbsID=<%= bbsID %>&savePath=<%=savePath%>" class="btn btn-primary">다운로드</a>
			 <% } %> 
			 
      </div> <!-- .row -->
    
  </div>

</main>
<%@include file = "/assets/footer.jsp"%>

</body>
</html>