package user;

import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.security.SecureRandom;
import java.util.Base64;

public class SHA256 {


    public static String startHashing(String source, User user){

        String result = "";
        byte[] a = source.getBytes();
        byte[] salt = new byte[16];
        new SecureRandom().nextBytes(salt);
        System.out.println("회원가입 시도시 솔트: " + salt);
        String saltString = Base64.getEncoder().encodeToString(salt);
        user.setsaltString(saltString);
        System.out.println("회원가입 시도시 솔트스트링: " + saltString);
        byte[] bytes = new byte[a.length+salt.length];

        System.arraycopy(a, 0, bytes, 0, a.length);
        System.arraycopy(salt, 0, bytes, 0, salt.length);

        try{
            MessageDigest md = MessageDigest.getInstance("SHA-256");
            md.update(bytes);

            byte[] byteData = md.digest();
            StringBuffer sb = new StringBuffer();
            for(int i =0; i<byteData.length; i++){
                sb.append(Integer.toString((byteData[i]&0xff) + 256, 16).substring(1));
            }
            result = sb.toString(); 
        }catch(Exception e){
            e.printStackTrace();
        }
        System.out.println("회원가입 시도시 : " + result);
        return result;
    };

    public static String alreadyHashed(String source, String uid){

        String result = "";
        UserDAO userDAO = new UserDAO();
        byte[] a = source.getBytes();
        byte[] salt = new byte[16];
        String saltString = userDAO.searchSaltString(uid);
        System.out.println("로그인 시도시 솔트스트링: " + saltString);
        salt = Base64.getDecoder().decode(saltString);
        System.out.println("로그인 시도시 솔트: " + salt);
        byte[] bytes = new byte[a.length+salt.length];

        System.arraycopy(a, 0, bytes, 0, a.length);
        System.arraycopy(salt, 0, bytes, 0, salt.length);

        try{
            MessageDigest md = MessageDigest.getInstance("SHA-256");
            md.update(bytes);

            byte[] byteData = md.digest();
            StringBuffer sb = new StringBuffer();
            for(int i =0; i<byteData.length; i++){
                sb.append(Integer.toString((byteData[i]&0xff) + 256, 16).substring(1));
            }
            result = sb.toString(); 
        }catch(Exception e){
            e.printStackTrace();
        }
        System.out.println("로그인 시도시 문자열 : " + result);
        return result;
    };
}